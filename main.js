!function(e){function t(t){for(var a,o,l=t[0],i=t[1],s=t[2],d=0,m=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&m.push(r[o][0]),r[o]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);for(u&&u(t);m.length;)m.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,l=1;l<n.length;l++){var i=n[l];0!==r[i]&&(a=!1)}a&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={0:0},c=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window.webpackJsonp=window.webpackJsonp||[],i=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var u=i;c.push([69,1]),n()}({10:function(e,t,n){"use strict";(function(e){n.d(t,"g",(function(){return o}));var a=n(45),r=n(18),c=n(22);n(16);n.d(t,"a",(function(){return c.a})),n.d(t,"b",(function(){return c.b})),n.d(t,"c",(function(){return c.c})),n.d(t,"d",(function(){return c.d})),n.d(t,"e",(function(){return c.e})),n.d(t,"f",(function(){return c.f})),n.d(t,"h",(function(){return c.g})),n.d(t,"i",(function(){return c.h}));class o{constructor(t){this.events=new a.EventEmitter,this.handleValueChanged=t=>{const n=t.target;this.emitBlock(e.from(n.value.buffer))},this.device=t,t.addEventListener("gattserverdisconnected",()=>{this.events.emit("disconnected")})}static async requestDevice(){const e=await navigator.bluetooth.requestDevice({filters:[{services:[30326]}],optionalServices:[r.b]});return new o(e)}async connect(){var e;if(this.server=await(null===(e=this.device.gatt)||void 0===e?void 0:e.connect()),void 0===this.server)return;const t=await this.server.getPrimaryService(r.b),n=await t.getCharacteristic(r.c);n.addEventListener("characteristicvaluechanged",this.handleValueChanged),await n.startNotifications()}async disconnect(){var e,t;try{await(null===(e=this.characteristic)||void 0===e?void 0:e.stopNotifications()),null===(t=this.device.gatt)||void 0===t||t.disconnect()}catch(e){}this.events.emit("disconnected"),this.events.removeAllListeners()}async sendCommand(e){var t;const n=await(null===(t=this.server)||void 0===t?void 0:t.getPrimaryService(r.b));if(void 0===n)return;const a=await n.getCharacteristic(r.a);await a.writeValue(e)}on(e,t){return this.events.on(e,t),()=>{this.events.off(e,t)}}emitBlock(e){try{const t=Object(c.i)(e);void 0===t?this.events.emit("failed",e):this.events.emit("packet",t)}catch(t){this.events.emit("failed",e)}}}}).call(this,n(34).Buffer)},16:function(e,t,n){"use strict";(function(e){function a(){return l(1)}function r(t){return l(8,e.of(0,t))}function c(t=new Date){const n=e.alloc(4);return n.writeUInt32BE(Math.trunc(t.getTime()/1e3)),l(9,n)}function o(t){return l(22,e.of(t?1:0))}function l(t,n=e.of()){const a=e.of(170,t),r=e.concat([a,n]),c=r.reduce((e,t)=>e+t,0);return e.of(...r,c)}n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return o}))}).call(this,n(34).Buffer)},18:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return c}));const a="6e400001-b5a3-f393-e0a9-e50e24dcca9e",r="6e400002-b5a3-f393-e0a9-e50e24dcca9e",c="6e400003-b5a3-f393-e0a9-e50e24dcca9e"},22:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return o})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"h",(function(){return u})),n.d(t,"i",(function(){return h}));class a{constructor(e){d(e,1)}toString(){return"Shutdown"}}class r{constructor(e){d(e,10)}toString(){return"No More History"}}class c{constructor(e){d(e,11,181),this.pm25=e.readUInt16BE(3),this.recordDate=new Date(1e3*e.readUInt32BE(7))}toString(){return"PM 2.5: "+this.pm25}}class o{constructor(e){d(e,80,254),this.capacity=e.readUInt8(3),this.isCharging=1===e.readUInt8(6),Object.freeze(this),Object.seal(this)}toString(){return this.isCharging?"Charging":`Battery: ${this.capacity}%`}}class l{constructor(e){d(e,80),this.runtime=e.readUInt32BE(3),this.boottime=e.readUInt32BE(7),Object.freeze(this),Object.seal(this)}toString(){return`Run time: ${this.runtime} sec, Boot time: ${this.boottime} sec`}}class i{constructor(e){d(e,80),this.pm25=e.readUInt16BE(3),this.recordDate=new Date(1e3*e.readUInt32BE(7)),this.currentDate=new Date(1e3*e.readUInt32BE(12)),Object.freeze(this),Object.seal(this)}toString(){return"PM 2.5: "+this.pm25}}class s{constructor(e){d(e,80,1),this.interval=e.readUInt16BE(3),this.enabled=0!==e.readUInt8(5),Object.freeze(this),Object.seal(this)}toString(){return this.enabled?`Internal: ${this.interval} minutes`:"Interval measurement disabled"}}class u{constructor(e){d(e,84),this.minor=e.readUInt16BE(2),this.major=e.readUInt16BE(4),Object.freeze(this),Object.seal(this)}toString(){return`${this.major}.${this.minor}`}}function d(e,t,n){if(170!==e[0])throw new Error("unexpected header");if(e[1]!==t)throw new Error("unexpected type");if(void 0!==n){if(e[e.length-1]!==(255&e.slice(3,e.length-1).reduce((e,t)=>e+t,n)))throw new Error("checksum failed")}}const m={aa01:a,aa0a:r,aa0b00:c,aa5004:o,aa5005:l,aa5006:i,aa5007:s,aa5400:u};function h(e){return new(m[e.slice(0,3).toString("hex")]||m[e.slice(0,2).toString("hex")])(e)}},24:function(e,t,n){e.exports={container:"_3Q4jVp-XdRE9lL_y-DHvqZ",table:"_12l9Lp-US87GiC9o0PbHWo",field:"_1BDqlaGx2FzEtv1WMIea58"}},46:function(e,t,n){e.exports={excellent:"_1MN1iQ__lDcfDATezKh6gq",good:"_2iF4fs9zFDhmn9gwKtuKZy","lightly-polluted":"IXUN-3jdHZPyDpVihuQSU","moderately-polluted":"_2JxHIf0Kw8tOb67KCYrrmO","heavily-polluted":"_2tXPdGxFj1gNC4vHrkw8sx","severely-polluted":"_4X8048EGadeXADBH2Wpyh"}},69:function(e,t,n){"use strict";n.r(t);n(48);var a=n(40),r=n.n(a),c=n(1),o=n.n(c),l=n(13),i=n.n(l),s=n(8),u=n(17),d=n(19),m=n(14),h=n(42),f=n(12),v=n(35),p=n(23),E=n(43),b=n.n(E),y=n(44),g=n(10),w=n(16);const O=b()("SENSOR"),j=Object(y.a)(O),C=O("SET_CONNECTED"),S=O("UPDATE_PACKET"),D=j("REQUEST_DEVICE",async()=>g.g.requestDevice()),N=j("CONNECT",async(e,t,n)=>{const{sensor:a}=n();null!==a&&(await a.connect(),t(C(!0)),a.on("disconnected",()=>t(C(!1))),a.on("packet",e=>t(S(e))),a.on("failed",e=>{console.log("Block",e.toString("hex").toUpperCase())}),await a.sendCommand(w.c()))}),I=j("DISCONNECT",async(e,t,n)=>{const{sensor:a}=n();return null==a?void 0:a.disconnect()}),x=j("SEND_MESSAGE",async(e,t,n)=>{const{sensor:a}=n();return null==a?void 0:a.sendCommand(e)}),P=e=>x(w.a(e));var B=Object(p.reducerWithInitialState)(null).case(D.async.done,(e,t)=>t.result),_=n(28);var U=Object(p.reducerWithInitialState)({connected:!1,shuttingdown:!1,latest:{},history:[],historyFully:!1}).case(C,(e,t)=>Object(_.a)(e,e=>{t||(e.shuttingdown=!1,e.latest={}),e.connected=t})).case(S,(e,t)=>Object(_.a)(e,e=>{e.shuttingdown=!1,t instanceof g.a?(e.latest.batteryCapacity=t.capacity,e.latest.batteryCharging=t.isCharging):t instanceof g.c?(e.latest.measurementInterval=t.interval,e.latest.measurementIntervalEnabled=t.enabled):t instanceof g.e?(e.latest.runTime=t.runtime,e.latest.bootTime=t.boottime):t instanceof g.f?(e.latest.pm25=t.pm25,e.latest.recordDate=t.recordDate):t instanceof g.i?e.latest.version=[t.major,t.minor]:t instanceof g.h?e.shuttingdown=!0:t instanceof g.b?e.history.push({pm25:t.pm25,recordDate:t.recordDate}):t instanceof g.d&&(e.historyFully=!0)}));const T=Object(f.b)(),k=m.d;var M=n(31),A=n.n(M),H=n(76),z=n(77),F=n(78),L=n(75),G=n(79),R=n(80),V=n(24),q=n.n(V),K=n(46),$=n.n(K);const W=({value:e})=>{if(void 0===e)return o.a.createElement("span",null,"N/A");const t=Q(e);return o.a.createElement("span",null,o.a.createElement("span",null,e," Î¼g/m",o.a.createElement("sup",null,"3")),o.a.createElement("span",{className:$.a[t]}," (",t.replace(/-/g," "),")"))};var X;!function(e){e.Excellent="excellent",e.Good="good",e.LightlyPolluted="lightly-polluted",e.ModeratelyPolluted="moderately-polluted",e.HeavilyPolluted="heavily-polluted",e.SeverelyPolluted="severely-polluted"}(X||(X={}));const Q=e=>e<=35?X.Excellent:e<=75?X.Good:e<=115?X.LightlyPolluted:e<=150?X.ModeratelyPolluted:e<=250?X.HeavilyPolluted:X.SeverelyPolluted;var J=n(81),Z=n(70),Y=n(71),ee=n(72),te=n(73),ne=n(74);const ae=[5,10,15,30,60,90,120],re=()=>{const e=o.a.useRef(null),[t,n]=o.a.useState(!1),a=Object(s.d)(),r=Object(s.e)(e=>e.report.connected),c=Object(s.e)(e=>e.report.latest.measurementInterval),l=Object(s.e)(e=>e.report.latest.measurementIntervalEnabled),i=()=>n(r&&!t),u=async e=>{n(!1),await a((e=>x(w.b(e)))(e)),await a(P(!0))};return o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{onClick:i},l?c+" minutes":"Disabled"),o.a.createElement(J.a,{placement:"bottom",isOpen:t,target:e,toggle:i},o.a.createElement(Z.a,null,"Measurement interval"),o.a.createElement(Y.a,null,o.a.createElement("p",null,"Current Interval: ",c," minutes"),o.a.createElement(ee.a,null,ae.map(e=>o.a.createElement(te.a,{onClick:()=>u(e),key:e,active:e===c},e," minutes")))),o.a.createElement(ne.a,null,o.a.createElement(L.a,{color:"primary",onClick:async()=>{n(!1),a(P(!1))},hidden:!l},"Disable"),o.a.createElement(L.a,{color:"secondary",onClick:i},"Cancel"))))},ce=()=>{var e,t,n,a,r;const c=Object(s.d)(),l=Object(s.e)(e=>e.report.connected),i=Object(s.e)(e=>e.report.shuttingdown),u=Object(s.e)(e=>e.report.latest);return o.a.createElement(H.a,{className:q.a.container},o.a.createElement(z.a,null,o.a.createElement(F.a,null,o.a.createElement(L.a,{color:l?"success":"primary",onClick:async()=>{l?await c(I()):(await c(D()),await c(N()))}},l?"Disconnect":"Connect"),o.a.createElement(L.a,{color:l?"danger":void 0,onClick:()=>c(x(w.d())),disabled:!l},i?"Shutting down":"Shutdown"))),o.a.createElement(z.a,null,o.a.createElement(G.a,{className:q.a.table,responsive:!0,borderless:!0},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{className:q.a.field},"#"),o.a.createElement("th",null,"Value"))),o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("td",null,"PM ",o.a.createElement("sub",null,"2.5")),o.a.createElement("td",{className:"text-monospace"},o.a.createElement(W,{value:u.pm25}))),o.a.createElement("tr",null,o.a.createElement("td",null,"Battery"),o.a.createElement("td",null,o.a.createElement(R.a,{value:null!==(e=u.batteryCapacity)&&void 0!==e?e:0},u.batteryCapacity?u.batteryCapacity+"%":"N/A"," ",u.batteryCharging?"(Charging)":"(Discharge)"))),o.a.createElement("tr",null,o.a.createElement("td",null,"Record date"),o.a.createElement("td",{className:"text-monospace"},null!==(n=null===(t=u.recordDate)||void 0===t?void 0:t.toLocaleString())&&void 0!==n?n:"N/A")),o.a.createElement("tr",null,o.a.createElement("td",null,"Runtime"),o.a.createElement("td",{className:"text-monospace"},u.runTime?A()(1e3*u.runTime):"N/A")),o.a.createElement("tr",null,o.a.createElement("td",null,"Boot time"),o.a.createElement("td",{className:"text-monospace"},u.bootTime?A()(1e3*u.bootTime):"N/A")),o.a.createElement("tr",null,o.a.createElement("td",null,"Measurement Interval"),o.a.createElement("td",{className:"text-monospace"},o.a.createElement(re,null))),o.a.createElement("tr",null,o.a.createElement("td",null,"Firmare version"),o.a.createElement("td",{className:"text-monospace"},null!==(r=null===(a=u.version)||void 0===a?void 0:a.join("."))&&void 0!==r?r:"N/A"))))))},oe=Object(m.e)((le=T,Object(m.c)({router:Object(d.b)(le),sensor:B,report:U})),void 0,k(Object(m.a)(Object(v.a)(T),h.a)));var le;const ie=()=>o.a.createElement(s.a,{store:oe},o.a.createElement(d.a,{history:T},o.a.createElement(u.c,null,o.a.createElement(u.a,{exact:!0,path:"/",component:ce}))));r()(()=>{const e=document.createElement("main");document.body=document.createElement("body"),document.body.appendChild(e),i.a.render(o.a.createElement(ie),e)})}});
//# sourceMappingURL=main.js.map